<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Pergaminho Arcano</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Uncial+Antiqua&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>

    <style>
        :root {
            --cor-arcana: #b24cff; /* Roxo arcano definido */
        }

        /* --- ESTILOS GERAIS --- */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000000; /* Preto absoluto */
            color: #ffffff;
            /* Fonte padrão (embora o texto principal seja Uncial Antiqua) */
            font-family: 'MedievalSharp', cursive;
            overflow: hidden; /* Proíbe o scroll manual */
        }

        /* --- SELO ARCANO (GATILHO) --- */
        #seal-container {
            position: fixed;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            cursor: pointer;
        }
        
        #arcane-seal-img {
            width: 100px; /* Tamanho base, ajuste se necessário */
            height: auto;
            
            /* Glow roxo sutil inicial */
            filter: drop-shadow(0 0 20px var(--cor-arcana));
            
            /* Transição suave para o estado "clicado" */
            transition: opacity 1.5s ease-out, filter 1.5s ease-out;
        }

        /* NOVO: Estado do selo após o clique */
        #arcane-seal-img.clicked {
            opacity: 0.6; /* Perde intensidade */
            filter: drop-shadow(0 0 8px var(--cor-arcana)); /* Glow diminui */
        }

        /* --- CENA 3D (THREE.JS) --- */
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* --- ASSINATURA FINAL --- */
        #signature-container {
            display: none; /* Começa escondido */
            opacity: 0;
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
            font-size: 1.5rem; /* 24px */
            font-family: 'MedievalSharp', cursive; /* Fonte específica da assinatura */
            transition: opacity 1s ease-in;
        }

        #signature {
            /* NOVO: Letras pretas, como definido */
            color: #000000;
            
            /* * NOVO: Animação de pulso em 60 BPM (1s) 
             * O text-shadow é agora controlado pelo @keyframes 
            */
            animation: pulse-arcano 1s ease-in-out infinite;
        }

        /* * NOVO: Animação de pulso para a assinatura (60 BPM = 1 segundo)
         * Simula a "respiração" ou "batimento" da aura roxa
         */
        @keyframes pulse-arcano {
            0%, 100% {
                /* Estado "contraído" do brilho */
                text-shadow:
                    0 0 7px #fff,
                    0 0 12px var(--cor-arcana),
                    0 0 20px var(--cor-arcana);
            }
            50% {
                /* Estado "expandido" do brilho (respiração) */
                text-shadow:
                    0 0 10px #fff,
                    0 0 20px var(--cor-arcana),
                    0 0 35px var(--cor-arcana),
                    0 0 50px var(--cor-arcana);
            }
        }
    </style>
</head>
<body>

    <div id="seal-container">
        <img id="arcane-seal-img" src="./selo-arcano.png" alt="Selo Arcano">
    </div>

    <canvas id="three-canvas"></canvas>

    <div id="signature-container">
        <p id="signature">Arcanista-mor Amaris Solun</p>
    </div>

    <script>
        // --- TEXTO LONGO (Estilo Pergaminho) ---
        // Este texto será renderizado com a fonte 'Uncial Antiqua'
        const LOREM_IPSUM_ARCANO = `
Nas veias do cosmo, onde a luz teme pisar,
o Vazio pulsa em compasso ancestral.
Ouve, neófito, o sussurro das eras:
as engrenagens do destino rangem.

A Sétima Estrela sangrou sobre o véu,
tecendo a runa da Despossessão.
E do pó de estrelas mortas,
o Primeiro Selo foi forjado.

Não busque o poder que corrompe,
mas o saber que liberta.
Pois no coração do silêncio,
a verdade aguarda, paciente.

A geometria do efêmero,
a matemática da alma.
Tudo se dobra à Vontade
quando a Vontade é una com o Todo.

O Tempo é um rio que flui para trás,
e a memória é a névoa em suas margens.
Caminhamos sobre pontes de luar,
buscando o que já foi perdido.

Somente aqueles que ousam
desvendar os nós do destino
encontrarão a chave.

A engrenagem gira.
O coração bate.
O caminho se revela.

Contempla a Cifra.
Entende o Padrão.
O selo se abre.
A jornada é tua.
        `;

        // --- VARIÁVEIS GLOBAIS ---
        let scene, camera, renderer;
        let sound;
        let crawlGroup, textMesh, textHeight;
        let animationInProgress = false;
        let endThreshold = 0; // Calculado dinamicamente

        // --- INICIALIZAÇÃO ---
        function init() {
            setupAudio();
            setupScene();
            setupListeners();
        }

        // --- CONFIGURAÇÃO DO ÁUDIO (HOWLER.JS) ---
        function setupAudio() {
            sound = new Howl({
                // O áudio deve estar na mesma pasta ou o caminho deve ser ajustado
                src: ['./audio-mecanismo.mp3'], // 60 BPM
                loop: true,
                volume: 0.6
            });
        }

        // --- CONFIGURAÇÃO DA CENA (THREE.JS) ---
        function setupScene() {
            const canvas = document.getElementById('three-canvas');
            scene = new THREE.Scene();

            const aspect = window.innerWidth / window.innerHeight;
            camera = new THREE.PerspectiveCamera(50, aspect, 1, 10000);
            camera.position.set(0, 150, 400); 
            camera.lookAt(0, 0, 0);
            scene.add(camera);

            renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                antialias: true,
                alpha: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        }

        // --- CONFIGURAÇÃO DOS EVENTOS ---
        function setupListeners() {
            document.getElementById('seal-container').addEventListener('click', startExperience, { once: true });
            window.addEventListener('resize', onWindowResize);
        }

        // --- AÇÃO PRINCIPAL (QUANDO O SELO É CLICADO) ---
        function startExperience() {
            if (animationInProgress) return;
            animationInProgress = true;

            // 1. NOVO: Selo perde intensidade (não some)
            const sealImg = document.getElementById('arcane-seal-img');
            sealImg.classList.add('clicked');
            
            // Impede cliques repetidos no container
            document.getElementById('seal-container').style.pointerEvents = 'none';

            // 2. Tocar o áudio
            sound.play();

            // 3. Criar e iniciar o texto 3D
            createCrawlText();
            
            // 4. Iniciar o loop de animação
            animate();
        }

        // --- CRIAÇÃO DO TEXTO 3D (O "CRAWL") ---
        function createCrawlText() {
            const textCanvas = createTextCanvas(LOREM_IPSUM_ARCANO);
            textHeight = textCanvas.height; 

            const texture = new THREE.CanvasTexture(textCanvas);
            texture.minFilter = THREE.LinearFilter;
            texture.magFilter = THREE.LinearFilter;

            const material = new THREE.MeshBasicMaterial({
                map: texture,
                transparent: true,
            });

            const geometry = new THREE.PlaneGeometry(textCanvas.width, textHeight);
            textMesh = new THREE.Mesh(geometry, material);

            crawlGroup = new THREE.Group();
            crawlGroup.add(textMesh);
            
            crawlGroup.rotation.x = -Math.PI / 3.5; 

            const startY = -textHeight / 2 - 400; 
            crawlGroup.position.y = startY;

            // Cálculo dinâmico do ponto final
            endThreshold = (textHeight * Math.cos(crawlGroup.rotation.x)) * 0.7;

            scene.add(crawlGroup);
        }

        // --- FUNÇÃO AUXILIAR: Desenha o texto em um Canvas 2D ---
        function createTextCanvas(text) {
            const lines = text.split('\n');
            const fontSize = 48; 
            const lineHeight = fontSize * 1.3;
            
            const canvasHeight = lines.length * lineHeight + (fontSize * 2);
            const canvasWidth = 1024; // Largura da textura

            const canvas = document.createElement('canvas');
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            const ctx = canvas.getContext('2d');
            
            // NOVO: Fonte 'Uncial Antiqua' para o texto principal
            ctx.font = `${fontSize}px 'Uncial Antiqua'`;
            ctx.fillStyle = '#FFFFFF'; // Texto branco
            ctx.textAlign = 'center';
            
            // NOVO: Efeito de brilho (aura) com a cor roxa definida
            ctx.shadowColor = 'var(--cor-arcana)'; // #b24cff
            ctx.shadowBlur = 10; // "leve brilho"
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;

            let y = fontSize * 2;
            for (const line of lines) {
                ctx.fillText(line, canvasWidth / 2, y);
                y += lineHeight;
            }

            return canvas;
        }

        // --- LOOP DE ANIMAÇÃO (requestAnimationFrame) ---
        function animate() {
            if (!animationInProgress) return;
            requestAnimationFrame(animate);

            // NOVO: Velocidade mais lenta e ritualística
            crawlGroup.position.y += 0.35; 

            if (crawlGroup.position.y > endThreshold) {
                finishAnimation();
            }

            renderer.render(scene, camera);
        }

        // --- FINALIZAÇÃO DA ANIMAÇÃO ---
        function finishAnimation() {
            animationInProgress = false;

            // Limpa o texto 3D da cena
            if (crawlGroup) {
                scene.remove(crawlGroup);
                textMesh.geometry.dispose();
                textMesh.material.map.dispose();
                textMesh.material.dispose();
            }

            // Mostra a assinatura (que agora pulsa via CSS)
            const signature = document.getElementById('signature-container');
            signature.style.display = 'block';
            setTimeout(() => {
                signature.style.opacity = '1';
            }, 100); 
        }

        // --- RESPONSIVIDADE ---
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- INICIAR TUDO ---
        init();
    </script>
</body>
</html>
